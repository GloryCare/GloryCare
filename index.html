<!DOCTYPE html>
<html lang="vi" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GloryCare â€” TÃ¢m LÃ½ Há»c Sinh</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FREE CHAT / FULL WIDTH
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #panelRight.hidden { display: none; }
    #panelLeft.full-width { width: 100%; border-right: none; }
    #panelLeft.full-width .messages-area { padding: 30px 80px; }
    #panelLeft.full-width .msg-bubble { max-width: 58%; }

    @media (max-width: 900px) {
        #panelLeft.full-width .messages-area { padding: 20px 24px; }
        #panelLeft.full-width .msg-bubble { max-width: 80%; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AI CHAT INPUT BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #chatInputArea {
        display: none;
        padding: 14px 80px 18px;
        border-top: 1px solid var(--border);
        background: var(--bg-card);
        backdrop-filter: blur(14px);
        flex-direction: column;
        gap: 6px;
        flex-shrink: 0;
    }

    @media (max-width: 900px) { #chatInputArea { padding: 12px 16px 16px; } }

    .chat-input-row { display: flex; align-items: flex-end; gap: 10px; }

    .chat-input-wrapper {
        flex: 1;
        background: var(--bg-primary);
        border: 1.5px solid var(--border-accent);
        border-radius: 20px;
        padding: 10px 18px;
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    .chat-input-wrapper:focus-within {
        border-color: var(--accent-rose);
        box-shadow: 0 0 0 3px rgba(200, 114, 104, 0.1);
    }

    #chatInput {
        width: 100%; background: none; border: none; outline: none;
        font-family: 'DM Sans', sans-serif; font-size: 15px;
        color: var(--text-primary); line-height: 1.55; resize: none;
        height: 24px; min-height: 24px; max-height: 120px; overflow-y: auto; display: block;
    }

    #chatInput::placeholder { color: var(--text-muted); }
    #chatInput::-webkit-scrollbar { width: 4px; }
    #chatInput::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 4px; }

    #chatSendBtn {
        width: 44px; height: 44px; border-radius: 50%; border: none;
        background: linear-gradient(135deg, var(--accent-rose), var(--accent-lavender));
        color: white; cursor: pointer; display: flex; align-items: center;
        justify-content: center; font-size: 15px; flex-shrink: 0;
        transition: all 0.25s cubic-bezier(0.34,1.4,0.64,1);
        box-shadow: 0 4px 14px rgba(200, 114, 104, 0.35);
    }

    #chatSendBtn:hover:not(:disabled) { transform: scale(1.1); box-shadow: 0 6px 22px rgba(200, 114, 104, 0.5); }
    #chatSendBtn:active:not(:disabled) { transform: scale(0.94); }
    #chatSendBtn:disabled { opacity: 0.45; cursor: not-allowed; }

    .chat-input-hint {
        text-align: center; font-size: 11.5px; color: var(--text-muted); letter-spacing: 0.3px;
    }

    /* Clickable bot bubble */
    .msg-bubble.clickable { cursor: pointer; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PEER CHAT SETUP SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #peerChatSetup {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        padding: 40px 32px;
        background: var(--bg-primary);
        overflow-y: auto;
    }

    .peer-setup-card {
        width: 100%;
        max-width: 480px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 28px;
        padding: 44px 40px;
        backdrop-filter: blur(20px);
        box-shadow: var(--shadow-md);
        animation: fadeUp 0.6s ease-out;
    }

    .peer-setup-icon {
        width: 72px; height: 72px;
        background: linear-gradient(135deg, var(--accent-lavender), var(--accent-rose));
        border-radius: 22px;
        display: flex; align-items: center; justify-content: center;
        font-size: 30px; color: white;
        margin: 0 auto 24px;
        box-shadow: 0 8px 28px rgba(139,124,168,0.35);
    }

    .peer-setup-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: 28px; font-weight: 500;
        color: var(--text-primary);
        text-align: center; margin-bottom: 8px;
    }

    .peer-setup-subtitle {
        font-size: 14px; color: var(--text-secondary);
        text-align: center; line-height: 1.65;
        margin-bottom: 32px; font-weight: 300;
    }

    .peer-setup-form { display: flex; flex-direction: column; gap: 16px; }

    .peer-form-label {
        font-size: 11px; text-transform: uppercase; letter-spacing: 2px;
        color: var(--text-secondary); font-weight: 500; margin-bottom: 6px; display: block;
    }

    .peer-form-input {
        width: 100%;
        padding: 12px 16px;
        background: var(--bg-primary);
        border: 1.5px solid var(--border-accent);
        border-radius: 14px;
        font-family: 'DM Sans', sans-serif;
        font-size: 14px;
        color: var(--text-primary);
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
        box-sizing: border-box;
    }

    .peer-form-input:focus {
        border-color: var(--accent-lavender);
        box-shadow: 0 0 0 3px rgba(139,124,168,0.12);
    }

    .peer-form-input::placeholder { color: var(--text-muted); }

    /* Dropdown chá»§ Ä‘á» â€” thay tháº¿ grid nÃºt */
    .peer-topic-select {
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%239A7060' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        padding-right: 36px;
    }

    .peer-topic-select option {
        background: var(--bg-primary);
        color: var(--text-primary);
        font-family: 'DM Sans', sans-serif;
        font-size: 14px;
    }

    .peer-find-btn {
        width: 100%; padding: 14px;
        background: linear-gradient(135deg, var(--accent-lavender), var(--accent-rose));
        border: none; border-radius: 16px;
        font-family: 'DM Sans', sans-serif;
        font-size: 15px; font-weight: 500; color: white;
        cursor: pointer; margin-top: 8px;
        transition: all 0.25s cubic-bezier(0.34,1.4,0.64,1);
        box-shadow: 0 6px 22px rgba(139,124,168,0.35);
    }

    .peer-find-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 10px 30px rgba(139,124,168,0.45); }
    .peer-find-btn:active { transform: scale(0.98); }

    .peer-privacy-note {
        text-align: center; font-size: 11.5px;
        color: var(--text-muted); margin-top: 12px;
        display: flex; align-items: center; justify-content: center; gap: 5px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WAITING INDICATOR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .waiting-indicator {
        display: flex; flex-direction: column;
        align-items: center; padding: 40px 20px; gap: 16px;
    }

    .waiting-pulse {
        position: relative; width: 80px; height: 80px;
        display: flex; align-items: center; justify-content: center;
    }

    .pulse-ring {
        position: absolute; inset: 0; border-radius: 50%;
        border: 2px solid var(--accent-lavender);
        animation: pulseRing 1.8s ease-out infinite;
    }

    .pulse-ring::before {
        content: ''; position: absolute; inset: -14px; border-radius: 50%;
        border: 1.5px solid var(--accent-lavender);
        animation: pulseRing 1.8s ease-out infinite 0.4s;
        opacity: 0.5;
    }

    @keyframes pulseRing {
        0% { transform: scale(0.7); opacity: 1; }
        100% { transform: scale(1.4); opacity: 0; }
    }

    .pulse-dot {
        width: 50px; height: 50px; border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-lavender), var(--accent-rose));
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; color: white;
        box-shadow: 0 4px 18px rgba(139,124,168,0.4);
        position: relative; z-index: 1;
    }

    .waiting-text {
        font-size: 14px; color: var(--text-secondary);
        font-style: italic; text-align: center;
    }

    .cancel-wait-btn {
        background: none; border: 1px solid var(--border);
        color: var(--text-secondary); border-radius: 10px;
        padding: 8px 20px; cursor: pointer; font-size: 13px;
        font-family: 'DM Sans', sans-serif;
        transition: all 0.2s;
    }

    .cancel-wait-btn:hover { border-color: var(--accent-rose); color: var(--accent-rose); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PEER CHAT ACTIVE BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #peerChatActive {
        display: none;
        align-items: center; justify-content: space-between;
        padding: 12px 80px;
        background: var(--bg-card);
        border-bottom: 1px solid var(--border);
        backdrop-filter: blur(10px);
        flex-shrink: 0;
    }

    @media (max-width: 900px) { #peerChatActive { padding: 10px 16px; } }

    .peer-active-info {
        display: flex; align-items: center; gap: 10px;
    }

    .peer-status-dot {
        width: 8px; height: 8px; border-radius: 50%;
        background: #5cb85c;
        box-shadow: 0 0 8px rgba(92,184,92,0.6);
        animation: pulse-dot 2s ease-in-out infinite;
    }

    .peer-partner-name {
        font-size: 14px; font-weight: 500; color: var(--text-primary);
    }

    .peer-partner-label {
        font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px;
    }

    .peer-leave-btn {
        background: none; border: 1px solid var(--border);
        color: var(--text-secondary); border-radius: 10px;
        padding: 7px 14px; cursor: pointer; font-size: 12px;
        font-family: 'DM Sans', sans-serif;
        display: flex; align-items: center; gap: 6px;
        transition: all 0.2s;
    }

    .peer-leave-btn:hover { border-color: var(--accent-rose); color: var(--accent-rose); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PEER CHAT INPUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #peerChatInputArea {
        display: none;
        padding: 14px 80px 18px;
        border-top: 1px solid var(--border);
        background: var(--bg-card);
        backdrop-filter: blur(14px);
        flex-direction: column;
        gap: 6px;
        flex-shrink: 0;
    }

    @media (max-width: 900px) { #peerChatInputArea { padding: 12px 16px 16px; } }

    #peerChatInput {
        width: 100%; background: none; border: none; outline: none;
        font-family: 'DM Sans', sans-serif; font-size: 15px;
        color: var(--text-primary); line-height: 1.55; resize: none;
        height: 24px; min-height: 24px; max-height: 120px; overflow-y: auto; display: block;
    }

    #peerChatInput::placeholder { color: var(--text-muted); }

    #peerSendBtn {
        width: 44px; height: 44px; border-radius: 50%; border: none;
        background: linear-gradient(135deg, var(--accent-lavender), var(--accent-rose));
        color: white; cursor: pointer; display: flex; align-items: center;
        justify-content: center; font-size: 15px; flex-shrink: 0;
        transition: all 0.25s cubic-bezier(0.34,1.4,0.64,1);
        box-shadow: 0 4px 14px rgba(139,124,168,0.35);
    }

    #peerSendBtn:hover:not(:disabled) { transform: scale(1.1); }
    #peerSendBtn:disabled { opacity: 0.45; cursor: not-allowed; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SYSTEM & PEER MESSAGES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .system-msg {
        display: flex; justify-content: center;
        animation: msgIn 0.4s ease-out;
    }

    .system-msg span {
        font-size: 12px; color: var(--text-muted);
        background: var(--toggle-bg);
        padding: 5px 14px; border-radius: 20px;
        font-style: italic;
    }

    .peer-avatar {
        background: linear-gradient(135deg, var(--accent-lavender), #a8c0e8) !important;
    }

    .peer-bubble {
        background: rgba(139,124,168,0.08) !important;
        border-color: rgba(139,124,168,0.2) !important;
    }

    .peer-bubble:hover {
        transform: none !important;
        border-color: rgba(139,124,168,0.35) !important;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RECONNECT & OFFLINE UI
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .reconnect-prompt {
        text-align: center; padding: 24px;
        animation: msgIn 0.4s ease-out;
    }

    .reconnect-prompt p {
        font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;
    }

    .reconnect-btn {
        background: linear-gradient(135deg, var(--accent-lavender), var(--accent-rose));
        border: none; border-radius: 14px;
        padding: 11px 24px; color: white;
        font-family: 'DM Sans', sans-serif; font-size: 14px;
        cursor: pointer; transition: all 0.25s;
        box-shadow: 0 4px 16px rgba(139,124,168,0.3);
    }

    .reconnect-btn:hover { transform: translateY(-2px); }

    .server-offline-notice {
        display: flex; flex-direction: column;
        align-items: center; padding: 32px 24px; gap: 12px;
        text-align: center;
        animation: msgIn 0.4s ease-out;
    }

    .offline-icon { font-size: 36px; opacity: 0.4; }

    .offline-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: 20px; color: var(--text-primary);
    }

    .offline-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.6; max-width: 340px; }

    .offline-cmd {
        background: var(--bg-secondary); padding: 8px 16px; border-radius: 8px;
        font-family: monospace; font-size: 13px; color: var(--accent-rose);
        border: 1px solid var(--border);
    }

    .offline-back-btn {
        background: none; border: 1px solid var(--border);
        color: var(--text-secondary); border-radius: 10px;
        padding: 8px 18px; cursor: pointer; font-size: 13px;
        font-family: 'DM Sans', sans-serif; transition: all 0.2s; margin-top: 8px;
    }

    .offline-back-btn:hover { border-color: var(--accent-lavender); color: var(--accent-lavender); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       "KHÃC" OPTION BUTTON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .opt-btn-other {
        padding: 7px 16px !important;
        min-height: unset !important;
        height: auto !important;
        line-height: 1.4 !important;
        background: transparent !important;
        border: 1px dashed var(--border) !important;
        box-shadow: none !important;
        display: inline-flex !important;
        align-items: center !important;
        width: auto !important;
        align-self: center !important;
        margin: 2px auto 0 !important;
        color: var(--text-muted) !important;
        font-size: 12px !important;
        font-weight: 400 !important;
        font-style: italic;
        opacity: 0.7;
        border-radius: 20px !important;
        transform: none !important;
        transition: opacity 0.2s, color 0.2s, border-color 0.2s, background 0.2s, border-style 0.1s !important;
    }

    .opt-btn-other::after { display: none !important; }

    .opt-btn-other:hover {
        opacity: 1 !important;
        color: var(--accent-lavender) !important;
        border-color: var(--accent-lavender) !important;
        border-style: solid !important;
        background: rgba(139,124,168,0.06) !important;
        transform: none !important;
        box-shadow: none !important;
    }

    .other-btn-inner {
        display: flex; align-items: center; gap: 5px;
    }

    .other-btn-icon { font-size: 10px; opacity: 0.6; }
    .other-btn-text { font-size: 12px; font-weight: 400; }
    .other-btn-sub { display: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       "KHÃC" OVERLAY PANEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .other-panel-overlay {
        position: fixed; inset: 0; z-index: 9999;
        background: rgba(0,0,0,0.38);
        backdrop-filter: blur(6px);
        display: flex; align-items: flex-end; justify-content: center;
        opacity: 0; pointer-events: none;
        transition: opacity 0.35s ease;
    }

    .other-panel-overlay.other-panel-show {
        opacity: 1; pointer-events: all;
    }

    .other-panel-overlay.other-panel-hide {
        opacity: 0; pointer-events: none;
    }

    .other-panel-card {
        width: 100%; max-width: 560px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 32px 32px 0 0;
        padding: 36px 36px 40px;
        position: relative;
        backdrop-filter: blur(24px);
        box-shadow: 0 -8px 48px rgba(0,0,0,0.18);
        transform: translateY(60px);
        transition: transform 0.45s cubic-bezier(0.34,1.2,0.64,1);
        max-height: 90vh;
        overflow-y: auto;
    }

    .other-panel-overlay.other-panel-show .other-panel-card {
        transform: translateY(0);
    }

    .other-panel-overlay.other-panel-hide .other-panel-card {
        transform: translateY(60px);
    }

    /* On larger screens, center as a modal */
    @media (min-width: 600px) {
        .other-panel-overlay { align-items: center; }
        .other-panel-card {
            border-radius: 32px;
            max-width: 520px;
            margin: 0 16px;
        }
    }

    .other-panel-close {
        position: absolute; top: 18px; right: 20px;
        width: 36px; height: 36px; border-radius: 50%;
        background: var(--bg-secondary); border: 1px solid var(--border);
        color: var(--text-muted); cursor: pointer; font-size: 14px;
        display: flex; align-items: center; justify-content: center;
        transition: all 0.2s;
    }

    .other-panel-close:hover {
        background: var(--toggle-bg); color: var(--text-primary);
        transform: rotate(90deg);
    }

    .other-panel-header { text-align: center; margin-bottom: 28px; }

    .other-panel-ornament {
        font-size: 28px; opacity: 0.45; margin-bottom: 10px;
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    .other-panel-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: 24px; font-weight: 500;
        color: var(--text-primary); margin-bottom: 8px;
    }

    .other-panel-sub {
        font-size: 13.5px; color: var(--text-secondary);
        line-height: 1.65; font-weight: 300; max-width: 380px; margin: 0 auto;
    }

    .other-panel-choices {
        display: flex; flex-direction: column; gap: 0;
    }

    .other-choices-divider {
        text-align: center; position: relative; margin: 6px 0;
    }

    .other-choices-divider::before {
        content: ''; position: absolute; top: 50%; left: 0; right: 0;
        height: 1px; background: var(--border);
    }

    .other-choices-divider span {
        background: var(--bg-card); padding: 0 12px;
        font-size: 11px; color: var(--text-muted);
        position: relative; text-transform: uppercase; letter-spacing: 2px;
    }

    .other-choice-card {
        position: relative; overflow: hidden;
        display: flex; align-items: center; gap: 16px;
        padding: 20px 20px;
        background: var(--bg-primary);
        border: 1.5px solid var(--border);
        border-radius: 20px;
        cursor: pointer; text-align: left;
        transition: all 0.3s cubic-bezier(0.34,1.2,0.64,1);
        font-family: 'DM Sans', sans-serif;
        color: var(--text-primary);
    }

    .other-choice-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 36px rgba(0,0,0,0.12);
    }

    .other-choice-card:hover .other-choice-glow {
        opacity: 1;
    }

    .other-choice-glow {
        position: absolute; inset: 0; opacity: 0;
        transition: opacity 0.4s;
        pointer-events: none;
        border-radius: inherit;
    }

    .other-choice-glow-ai {
        background: linear-gradient(135deg, rgba(200,114,104,0.08), rgba(200,114,104,0.03));
        border: 1.5px solid rgba(200,114,104,0.35);
        inset: -1px;
        border-radius: inherit;
    }

    .other-choice-glow-peer {
        background: linear-gradient(135deg, rgba(139,124,168,0.08), rgba(139,124,168,0.03));
        border: 1.5px solid rgba(139,124,168,0.35);
        inset: -1px;
        border-radius: inherit;
    }

    .other-choice-icon-wrap {
        width: 52px; height: 52px; border-radius: 16px;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; color: white; flex-shrink: 0;
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .other-choice-icon-ai {
        background: linear-gradient(135deg, #c87268, #d4897f);
    }

    .other-choice-icon-peer {
        background: linear-gradient(135deg, #8b7ca8, #a093c2);
    }

    .other-choice-content { flex: 1; }

    .other-choice-title {
        font-size: 15px; font-weight: 500; color: var(--text-primary);
        margin-bottom: 4px;
    }

    .other-choice-desc {
        font-size: 12.5px; color: var(--text-secondary);
        line-height: 1.55; font-weight: 300;
    }

    .other-choice-arrow {
        color: var(--text-muted); font-size: 13px; flex-shrink: 0;
        transition: transform 0.2s;
    }

    .other-choice-card:hover .other-choice-arrow {
        transform: translateX(4px);
        color: var(--text-secondary);
    }

    .other-panel-footer {
        text-align: center; font-size: 11px;
        color: var(--text-muted); margin-top: 20px;
    }
    </style>
</head>
<body>
    <canvas id="sakura-canvas"></canvas>

    <div class="app">
        <!-- HEADER -->
        <header class="header">
            <div class="logo-area">
                <div class="logo-icon">âœ¿</div>
                <div class="logo-text">
                    <span class="logo-name">GloryCare</span>
                    <span class="logo-tagline">Báº¡n Ä‘á»“ng hÃ nh tÃ¢m lÃ½ há»c sinh</span>
                </div>
            </div>
            <div class="header-actions">
                <div class="header-status">
                    <div class="status-dot"></div>
                    <span>Sáºµn sÃ ng láº¯ng nghe</span>
                </div>
                <div class="theme-toggle" id="themeToggle" title="Chuyá»ƒn giao diá»‡n">
                    <span class="theme-icon sun">â˜€</span>
                    <span class="theme-icon moon">â˜¾</span>
                </div>
            </div>
        </header>

        <main class="main">
            <!-- WELCOME SCREEN -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-inner">
                    <div class="welcome-hero">
                        <div class="welcome-ornament">âœ¿</div>
                        <h1 class="welcome-title">Báº¡n <em>khÃ´ng cÃ´ Ä‘Æ¡n</em><br>trong hÃ nh trÃ¬nh nÃ y</h1>
                        <p class="welcome-subtitle">Má»™t khÃ´ng gian an toÃ n Ä‘á»ƒ báº¡n chia sáº», Ä‘Æ°á»£c láº¯ng nghe vÃ  tÃ¬m láº¡i sá»± bÃ¬nh yÃªn trong tÃ¢m há»“n.</p>
                    </div>
                    <div class="welcome-divider">
                        <div class="divider-line"></div>
                        <span class="divider-flower">â€</span>
                        <div class="divider-line"></div>
                    </div>
                    <p class="topics-label">HÃ´m nay báº¡n muá»‘n tÃ¢m sá»± vá» Ä‘iá»u gÃ¬?</p>
                    <div class="topics-grid">
                        <div class="topic-card" onclick="selectTopic('stress')">
                            <div class="topic-icon"><i class="fas fa-cloud-rain"></i></div>
                            <div class="topic-name">Lo láº¯ng & CÄƒng tháº³ng</div>
                            <div class="topic-desc">Ãp lá»±c thi cá»­, gia Ä‘Ã¬nh, tÆ°Æ¡ng lai</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('sleep')">
                            <div class="topic-icon"><i class="fas fa-moon"></i></div>
                            <div class="topic-name">Máº¥t ngá»§</div>
                            <div class="topic-desc">KhÃ³ ngá»§, Ã¡c má»™ng, suy nghÄ© Ä‘Ãªm khuya</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('relationship')">
                            <div class="topic-icon"><i class="fas fa-heart"></i></div>
                            <div class="topic-name">Má»‘i quan há»‡</div>
                            <div class="topic-desc">Báº¡n bÃ¨, gia Ä‘Ã¬nh, tÃ¬nh cáº£m</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('study')">
                            <div class="topic-icon"><i class="fas fa-book-open"></i></div>
                            <div class="topic-name">Há»c táº­p</div>
                            <div class="topic-desc">Äá»™ng lá»±c, phÆ°Æ¡ng phÃ¡p, trÃ¬ hoÃ£n</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('chat')">
                            <div class="topic-icon"><i class="fas fa-robot"></i></div>
                            <div class="topic-name">TrÃ² chuyá»‡n AI</div>
                            <div class="topic-desc">Chat vá»›i AI, 24/7</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('general')">
                            <div class="topic-icon"><i class="fas fa-users"></i></div>
                            <div class="topic-name">Káº¿t ná»‘i báº¡n bÃ¨</div>
                            <div class="topic-desc">NÃ³i chuyá»‡n áº©n danh vá»›i ngÆ°á»i tháº­t</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CHAT LAYOUT -->
            <div class="chat-layout" id="chatLayout">
                <!-- LEFT: messages panel -->
                <div class="panel-left" id="panelLeft">
                    <div class="panel-left-header">
                        <div class="panel-left-title">
                            <button class="panel-back-btn" onclick="goHome()" title="Vá» trang chá»§"><i class="fas fa-arrow-left"></i></button>
                            <div class="chat-topic-badge" id="topicBadge">â€”</div>
                        </div>
                        <button class="panel-reset-btn" onclick="resetChat()" title="LÃ m má»›i cuá»™c trÃ² chuyá»‡n"><i class="fas fa-redo-alt"></i></button>
                    </div>

                    <!-- PEER CHAT: Active status bar -->
                    <div id="peerChatActive">
                        <div class="peer-active-info">
                            <div class="peer-status-dot"></div>
                            <div>
                                <div class="peer-partner-name" id="peerPartnerName">â€”</div>
                                <div class="peer-partner-label">Äang káº¿t ná»‘i</div>
                            </div>
                        </div>
                        <button class="peer-leave-btn" onclick="leavePeerChat()">
                            <i class="fas fa-sign-out-alt" style="font-size:11px"></i> Rá»i phÃ²ng
                        </button>
                    </div>

                    <!-- Messages area -->
                    <div class="messages-area" id="messagesArea"></div>

                    <!-- PEER CHAT: Setup screen (inside panel) -->
                    <div id="peerChatSetup">
                        <div class="peer-setup-card">
                            <div class="peer-setup-icon">ğŸ«‚</div>
                            <h2 class="peer-setup-title">Káº¿t ná»‘i vá»›i ngÆ°á»i báº¡n</h2>
                            <p class="peer-setup-subtitle">Chia sáº» vá»›i ngÆ°á»i láº¡ â€” Ä‘Ã´i khi nÃ³i chuyá»‡n vá»›i ngÆ°á»i khÃ´ng quen láº¡i dá»… hÆ¡n. HoÃ n toÃ n áº©n danh.</p>

                            <div class="peer-setup-form">
                                <div>
                                    <label class="peer-form-label">TÃªn hiá»ƒn thá»‹ (áº©n danh)</label>
                                    <input
                                        type="text"
                                        id="peerNicknameInput"
                                        class="peer-form-input"
                                        placeholder="VD: MÃ¢yNhá», Soul, Glory"
                                        maxlength="20"
                                    />
                                </div>

                                <div>
                                    <label class="peer-form-label">Muá»‘n nÃ³i vá»â€¦</label>
                                    <select id="peerTopicSelect" class="peer-form-input peer-topic-select">
                                        <option value="any">âœ¨ Báº¥t ká»³</option>
                                        <option value="study">ğŸ“š Há»c táº­p</option>
                                        <option value="family">ğŸ¡ Gia Ä‘Ã¬nh</option>
                                        <option value="love">ğŸ’Œ TÃ¬nh cáº£m</option>
                                        <option value="lonely">ğŸ«‚ CÃ´ Ä‘Æ¡n</option>
                                        <option value="bro">ğŸ’™ TÃ¡n gáº«u</option>
                                    </select>
                                </div>

                                <button class="peer-find-btn" onclick="startFindingPeer()">
                                    <i class="fas fa-search" style="margin-right:8px;font-size:13px"></i>
                                    TÃ¬m ngÆ°á»i láº¯ng nghe
                                </button>

                                <p class="peer-privacy-note">
                                    <i class="fas fa-lock" style="font-size:10px"></i>
                                    HoÃ n toÃ n áº©n danh Â· KhÃ´ng lÆ°u lá»‹ch sá»­
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- AI CHAT INPUT BAR -->
                    <div id="chatInputArea">
                        <div class="chat-input-row">
                            <div class="chat-input-wrapper">
                                <textarea
                                    id="chatInput"
                                    placeholder="Nháº¯n gÃ¬ cho mÃ¬nh Ä‘iâ€¦"
                                    rows="1"
                                    oninput="autoResizeTextarea(this)"
                                    onkeydown="handleChatKeydown(event)"
                                ></textarea>
                            </div>
                            <button id="chatSendBtn" onclick="sendMessage()" title="Gá»­i">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="chat-input-hint">Enter Ä‘á»ƒ gá»­i &nbsp;Â·&nbsp; Shift+Enter xuá»‘ng dÃ²ng</div>
                    </div>

                    <!-- PEER CHAT INPUT BAR -->
                    <div id="peerChatInputArea">
                        <div class="chat-input-row">
                            <div class="chat-input-wrapper">
                                <textarea
                                    id="peerChatInput"
                                    placeholder="Nháº¯n cho ngÆ°á»i báº¡nâ€¦"
                                    rows="1"
                                    oninput="autoResizeTextarea(this); handlePeerTyping();"
                                    onkeydown="handlePeerKeydown(event)"
                                ></textarea>
                            </div>
                            <button id="peerSendBtn" onclick="sendPeerMessage()" title="Gá»­i">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="chat-input-hint">Enter Ä‘á»ƒ gá»­i &nbsp;Â·&nbsp; Shift+Enter xuá»‘ng dÃ²ng</div>
                    </div>
                </div>

                <!-- RIGHT: options (hidden for free-chat topics) -->
                <div class="panel-right" id="panelRight">
                    <div class="panel-right-header">
                        <span class="panel-right-label">Xin hÃ£y chia sáº»</span>
                        <span class="option-count" id="optionCount">0 lá»±a chá»n</span>
                    </div>
                    <div class="options-scroll" id="optionsScroll"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-box">
            <button class="modal-close-btn" onclick="closeModal()"><i class="fas fa-times"></i></button>
            <div class="modal-header-label">âœ¿ Pháº£n há»“i Ä‘áº§y Ä‘á»§</div>
            <div class="modal-text" id="modalText"></div>
        </div>
    </div>

    <script src="conversations.js"></script>
    <script src="script.js"></script>
    <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PEER TOPIC SELECTOR â€” dÃ¹ng native <select>, khÃ´ng cáº§n JS riÃªng
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SAKURA PARTICLE SYSTEM
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    (function() {
        const canvas = document.getElementById('sakura-canvas');
        const ctx = canvas.getContext('2d');
        let W, H, petals = [];
        const MAX = 38;

        function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        function createPetal() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const colors = isDark
                ? ['rgba(220,130,110,0.45)', 'rgba(240,160,140,0.35)', 'rgba(255,185,165,0.28)', 'rgba(200,110,90,0.4)']
                : ['rgba(240,170,165,0.55)', 'rgba(255,200,195,0.45)', 'rgba(245,185,180,0.5)', 'rgba(230,150,145,0.4)', 'rgba(255,220,215,0.4)'];
            return {
                x: Math.random() * W, y: -20 - Math.random() * 100,
                size: 6 + Math.random() * 9, speedY: 0.6 + Math.random() * 1.2,
                speedX: (Math.random() - 0.5) * 0.8, rot: Math.random() * Math.PI * 2,
                rotSpeed: (Math.random() - 0.5) * 0.035, sway: Math.random() * Math.PI * 2,
                swaySpeed: 0.008 + Math.random() * 0.012, swayAmp: 0.5 + Math.random() * 1.5,
                color: colors[Math.floor(Math.random() * colors.length)],
                opacity: 0.3 + Math.random() * 0.5, type: Math.floor(Math.random() * 3)
            };
        }

        function drawPetal(p) {
            ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot); ctx.globalAlpha = p.opacity;
            ctx.beginPath();
            if (p.type === 0) { ctx.ellipse(0, 0, p.size * 0.45, p.size * 0.8, 0, 0, Math.PI * 2); }
            else if (p.type === 1) {
                ctx.moveTo(0, -p.size * 0.8);
                ctx.bezierCurveTo(p.size * 0.6, -p.size * 0.3, p.size * 0.4, p.size * 0.5, 0, p.size * 0.6);
                ctx.bezierCurveTo(-p.size * 0.4, p.size * 0.5, -p.size * 0.6, -p.size * 0.3, 0, -p.size * 0.8);
            } else {
                ctx.moveTo(0, -p.size * 0.7);
                ctx.bezierCurveTo(p.size * 0.5, -p.size * 0.2, p.size * 0.5, p.size * 0.5, 0, p.size * 0.5);
                ctx.bezierCurveTo(-p.size * 0.5, p.size * 0.5, -p.size * 0.5, -p.size * 0.2, 0, -p.size * 0.7);
            }
            const grad = ctx.createRadialGradient(0, -p.size * 0.1, 0, 0, 0, p.size);
            grad.addColorStop(0, p.color.replace(/[\d.]+\)$/, '0.9)'));
            grad.addColorStop(1, p.color);
            ctx.fillStyle = grad; ctx.fill();
            ctx.beginPath(); ctx.moveTo(0, -p.size * 0.6); ctx.lineTo(0, p.size * 0.4);
            ctx.strokeStyle = p.color.replace(/[\d.]+\)$/, '0.3)'); ctx.lineWidth = 0.5; ctx.stroke();
            ctx.restore();
        }

        function update() {
            ctx.clearRect(0, 0, W, H);
            if (petals.length < MAX && Math.random() < 0.06) petals.push(createPetal());
            petals = petals.filter(p => p.y < H + 40);
            for (const p of petals) {
                p.sway += p.swaySpeed; p.x += p.speedX + Math.sin(p.sway) * p.swayAmp;
                p.y += p.speedY; p.rot += p.rotSpeed; drawPetal(p);
            }
            requestAnimationFrame(update);
        }
        update();

        window.__updatePetalColors = function() {
            petals.forEach(p => {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                const colors = isDark
                    ? ['rgba(220,130,110,0.45)', 'rgba(240,160,140,0.35)', 'rgba(255,185,165,0.28)']
                    : ['rgba(240,170,165,0.55)', 'rgba(255,200,195,0.45)', 'rgba(245,185,180,0.5)'];
                p.color = colors[Math.floor(Math.random() * colors.length)];
            });
        };
    })();

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME TOGGLE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    document.getElementById('themeToggle').addEventListener('click', function() {
        const html = document.documentElement;
        const isDark = html.getAttribute('data-theme') === 'dark';
        html.setAttribute('data-theme', isDark ? 'light' : 'dark');
        if (window.__updatePetalColors) window.__updatePetalColors();
    });
    </script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
</body>
</html>
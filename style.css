:root {
            --bg-primary: #FAF6F2;
            --bg-secondary: #F2EDE8;
            --bg-card: rgba(255,255,255,0.85);
            --bg-glass: rgba(255,255,255,0.6);
            --border: rgba(180,140,120,0.18);
            --border-accent: rgba(210,170,150,0.35);
            --text-primary: #2D1F1A;
            --text-secondary: #6A4C44;
            --text-muted: #9A7060;
            --accent-rose: #C87268;
            --accent-blush: #E0A898;
            --accent-sage: #7A9E8A;
            --accent-lavender: #8B7CA8;
            --accent-peach: #E8B490;
            --chat-user-bg: linear-gradient(135deg, #C87268, #B05E54);
            --chat-bot-bg: rgba(255,255,255,0.9);
            --shadow-soft: 0 4px 24px rgba(100,60,40,0.08);
            --shadow-md: 0 8px 40px rgba(100,60,40,0.12);
            --shadow-lg: 0 20px 60px rgba(100,60,40,0.15);
            --panel-left: #FAF6F2;
            --panel-right: #F5EEE9;
            --option-hover: rgba(200,114,104,0.08);
            --scrollbar: rgba(180,140,120,0.25);
            --header-bg: rgba(250,246,242,0.9);
            --toggle-bg: rgba(180,140,120,0.15);
            --toggle-dot: #C87268;
            --petal: #F2B8B0;
            --petal2: #F7D4CF;
            --petal3: #FAEAE7;
        }

        /* ══════════════════════════════════════════
           DARK MODE — ấm áp, chữa lành, không âm u
           Bảng màu: nâu sô-cô-la ấm + đào hồng + xanh sage
        ══════════════════════════════════════════ */
        [data-theme="dark"] {
            --bg-primary: #2A1F1A;
            --bg-secondary: #311F18;
            --bg-card: rgba(58,36,28,0.88);
            --bg-glass: rgba(58,36,28,0.72);
            --border: rgba(200,150,120,0.2);
            --border-accent: rgba(210,160,130,0.38);

            /* Chữ sáng hơn, ấm hơn */
            --text-primary: #F5E8DE;
            --text-secondary: #D4A890;
            --text-muted: #A07860;

            /* Màu nhấn ấm, rực rỡ hơn để nổi trên nền tối */
            --accent-rose: #E8907E;
            --accent-blush: #DDA090;
            --accent-sage: #90B89C;
            --accent-lavender: #A090C0;
            --accent-peach: #D8A878;

            --chat-user-bg: linear-gradient(135deg, #D07868, #B06050);
            --chat-bot-bg: rgba(68,42,32,0.95);
            --shadow-soft: 0 4px 24px rgba(0,0,0,0.35);
            --shadow-md: 0 8px 40px rgba(0,0,0,0.45);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.55);
            --panel-left: #2A1F1A;
            --panel-right: #2E1E16;
            --option-hover: rgba(220,130,100,0.14);
            --scrollbar: rgba(200,140,100,0.3);
            --header-bg: rgba(38,26,20,0.97);
            --toggle-bg: rgba(200,140,100,0.22);
            --toggle-dot: #E8907E;
            --petal: rgba(220,130,110,0.5);
            --petal2: rgba(240,160,140,0.4);
            --petal3: rgba(255,190,170,0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            width: 100%; height: 100%;
            font-family: 'DM Sans', sans-serif;
            font-size: 15px; /* tăng base font */
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            transition: background 0.4s ease, color 0.4s ease;
        }

        /* ──────────────── SAKURA CANVAS ──────────────── */
        #sakura-canvas {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;  /* Cho phép tương tác với nội dung bên dưới */
          z-index: -1;           /* Đưa canvas xuống dưới cùng */
        }

        /* ──────────────── APP LAYOUT ──────────────── */
        .app {
            position: relative;
            z-index: 1;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* ──────────────── HEADER ──────────────── */
        .header {
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 36px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 10;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 42px; height: 42px;
            background: linear-gradient(135deg, var(--accent-rose), var(--accent-lavender));
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 16px rgba(180,100,90,0.3);
        }

        .logo-text {
            display: flex; flex-direction: column;
        }

        .logo-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 23px;
            font-weight: 600;
            letter-spacing: 1px;
            color: var(--text-primary);
            line-height: 1;
        }

        .logo-tagline {
            font-size: 12px; /* tăng từ 11 */
            color: var(--text-secondary); /* dùng secondary thay muted */
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        .header-actions {
            display: flex; align-items: center; gap: 16px;
        }

        .header-status {
            display: flex; align-items: center; gap: 7px;
            font-size: 12.5px; /* tăng nhẹ */
            color: var(--text-secondary);
        }

        .status-dot {
            width: 7px; height: 7px;
            border-radius: 50%;
            background: var(--accent-sage);
            box-shadow: 0 0 8px rgba(139,174,154,0.6);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.8); }
        }

        /* Theme toggle */
        .theme-toggle {
            position: relative;
            width: 52px; height: 28px;
            background: var(--toggle-bg);
            border: 1px solid var(--border-accent);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; align-items: center;
            padding: 3px;
        }

        .theme-toggle::after {
            content: '';
            width: 20px; height: 20px;
            border-radius: 50%;
            background: var(--toggle-dot);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
        }

        [data-theme="dark"] .theme-toggle::after {
            transform: translateX(24px);
        }

        .theme-icon {
            position: absolute;
            font-size: 10px;
            transition: opacity 0.3s;
        }

        .theme-icon.sun { left: 7px; color: #D4A060; }
        .theme-icon.moon { right: 7px; color: #A0A8D0; }

        /* ──────────────── MAIN AREA ──────────────── */
        .main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* ──────────────── WELCOME SCREEN ──────────────── */
        .welcome-screen {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: var(--bg-primary);
            overflow-y: auto;
            backdrop-filter: blur(2px); 
        }

        .welcome-inner {
            max-width: 700px;
            width: 100%;
            animation: fadeUp 0.8s ease-out;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-hero {
            text-align: center;
            margin-bottom: 52px;
        }

        .welcome-ornament {
            margin-top: 10px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 72px;
            line-height: 1;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent-rose), var(--accent-lavender), var(--accent-sage));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 8px rgba(180,100,90,0.2));
        }

        .welcome-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 44px; /* tăng từ 42 */
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 16px;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .welcome-title em {
            font-style: italic;
            color: var(--accent-rose);
        }

        .welcome-subtitle {
            font-size: 16px; /* tăng từ 15 */
            color: var(--text-secondary);
            line-height: 1.75;
            font-weight: 300;
            max-width: 440px;
            margin: 0 auto;
        }

        .welcome-divider {
            display: flex; align-items: center; gap: 16px;
            margin: 40px 0;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-accent), transparent);
        }

        .divider-flower {
            font-size: 17px;
            color: var(--accent-blush);
        }

        .topics-label {
            font-size: 12px; /* tăng từ 11 */
            text-transform: uppercase;
            letter-spacing: 2.5px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 24px;
            font-weight: 500;
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
        }

        .topic-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 26px 20px;
            cursor: pointer;
            transition: all 0.35s cubic-bezier(0.34,1.2,0.64,1);
            text-align: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .topic-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--card-accent-a, rgba(200,114,104,0.06)), var(--card-accent-b, rgba(139,124,168,0.06)));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .topic-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-md); border-color: var(--border-accent); }
        .topic-card:hover::before { opacity: 1; }

        .topic-card:nth-child(1) { --card-accent-a: rgba(200,114,104,0.1); --card-accent-b: rgba(232,180,144,0.08); }
        .topic-card:nth-child(2) { --card-accent-a: rgba(122,158,138,0.1); --card-accent-b: rgba(139,124,168,0.08); }
        .topic-card:nth-child(3) { --card-accent-a: rgba(139,124,168,0.1); --card-accent-b: rgba(200,114,104,0.08); }
        .topic-card:nth-child(4) { --card-accent-a: rgba(232,180,144,0.1); --card-accent-b: rgba(122,158,138,0.08); }
        .topic-card:nth-child(5) { --card-accent-a: rgba(200,114,104,0.1); --card-accent-b: rgba(122,158,138,0.08); }
        .topic-card:nth-child(6) { --card-accent-a: rgba(139,124,168,0.1); --card-accent-b: rgba(232,180,144,0.08); }

        .topic-icon {
            width: 48px; height: 48px;
            border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            font-size: 21px;
            margin: 0 auto 14px;
        }

        .topic-card:nth-child(1) .topic-icon { background: rgba(200,114,104,0.12); color: var(--accent-rose); }
        .topic-card:nth-child(2) .topic-icon { background: rgba(122,158,138,0.12); color: var(--accent-sage); }
        .topic-card:nth-child(3) .topic-icon { background: rgba(139,124,168,0.12); color: var(--accent-lavender); }
        .topic-card:nth-child(4) .topic-icon { background: rgba(232,180,144,0.12); color: var(--accent-peach); }
        .topic-card:nth-child(5) .topic-icon { background: rgba(200,114,104,0.12); color: var(--accent-rose); }
        .topic-card:nth-child(6) .topic-icon { background: rgba(139,124,168,0.12); color: var(--accent-lavender); }

        .topic-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 18px; /* tăng từ 17 */
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 7px;
        }

        .topic-desc {
            font-size: 12.5px; /* tăng từ 11.5 */
            color: var(--text-secondary);
            line-height: 1.55;
            font-weight: 300;
        }

        /* ──────────────── CHAT LAYOUT: 2 PANELS ──────────────── */
        .chat-layout {
            width: 100%;
            display: none;
            height: 100%;
        }

        .chat-layout.active {
            display: flex;
        }

        /* LEFT PANEL — conversation history */
        .panel-left {
            width: 55%;
            display: flex;
            flex-direction: column;
            background: var(--panel-left);
            border-right: 1px solid var(--border);
            position: relative;
        }

        .panel-left-header {
            padding: 20px 28px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            background: var(--bg-card);
            backdrop-filter: blur(10px);
        }

        .panel-left-title {
            display: flex; align-items: center; gap: 12px;
        }

        .chat-topic-badge {
            font-size: 12px; /* tăng từ 11 */
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--accent-rose);
            background: rgba(200,114,104,0.1);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid rgba(200,114,104,0.22);
        }

        .panel-back-btn {
            background: none; border: 1px solid var(--border);
            width: 34px; height: 34px;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }

        .panel-back-btn:hover { border-color: var(--accent-rose); color: var(--accent-rose); transform: translateX(-2px); }

        .panel-reset-btn {
            background: none; border: 1px solid var(--border);
            width: 34px; height: 34px;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }

        .panel-reset-btn:hover { border-color: var(--accent-lavender); color: var(--accent-lavender); }

        /* MESSAGES */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px 28px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            scroll-behavior: smooth;
        }

        .messages-area::-webkit-scrollbar { width: 5px; }
        .messages-area::-webkit-scrollbar-track { background: transparent; }
        .messages-area::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 10px; }

        .msg {
            display: flex;
            animation: msgIn 0.4s cubic-bezier(0.34,1.2,0.64,1);
        }

        @keyframes msgIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .msg.user { justify-content: flex-end; }
        .msg.bot { justify-content: flex-start; }

        .msg-bubble {
            max-width: 72%;
            padding: 14px 20px; /* padding rộng hơn */
            border-radius: 18px;
            font-size: 15px; /* tăng từ 14.5 */
            line-height: 1.7;
            position: relative;
        }

        .msg.user .msg-bubble {
            background: var(--chat-user-bg);
            color: white;
            border-bottom-right-radius: 5px;
            box-shadow: 0 4px 16px rgba(180,100,90,0.25);
        }

        .msg.bot .msg-bubble {
            background: var(--chat-bot-bg);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-bottom-left-radius: 5px;
            box-shadow: var(--shadow-soft);
            cursor: pointer;
            transition: all 0.25s;
        }

        .msg.bot .msg-bubble:hover {
            transform: translateX(4px);
            border-color: var(--accent-blush);
            box-shadow: 0 6px 24px rgba(180,100,90,0.12);
        }

        .msg-avatar {
            width: 32px; height: 32px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .msg.bot .msg-avatar {
            background: linear-gradient(135deg, var(--accent-rose), var(--accent-lavender));
            color: white;
            margin-right: 10px;
            box-shadow: 0 2px 10px rgba(180,100,90,0.2);
        }

        /* Typing dots */
        .typing-bubble {
            background: var(--chat-bot-bg);
            border: 1px solid var(--border);
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            padding: 14px 20px;
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .typing-dot {
            width: 7px; height: 7px;
            border-radius: 50%;
            background: var(--accent-blush);
            animation: typingBounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-7px); opacity: 1; }
        }

        /* RIGHT PANEL — options */
        .panel-right {
            width: 45%;
            display: flex;
            flex-direction: column;
            background: var(--panel-right);
        }

        .panel-right-header {
            padding: 20px 28px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-right-label {
            font-size: 12px; /* tăng từ 11 */
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .option-count {
            font-size: 12px; /* tăng từ 11 */
            color: var(--text-secondary);
            background: var(--toggle-bg);
            padding: 3px 10px;
            border-radius: 20px;
        }

        .options-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 22px 22px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .options-scroll::-webkit-scrollbar { width: 5px; }
        .options-scroll::-webkit-scrollbar-track { background: transparent; }
        .options-scroll::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 10px; }

        /* Option button */
        .opt-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px 20px;
            font-size: 14.5px; /* tăng từ 14 */
            color: var(--text-primary);
            cursor: pointer;
            text-align: left;
            line-height: 1.55;
            font-family: 'DM Sans', sans-serif;
            font-weight: 400;
            transition: all 0.3s cubic-bezier(0.34,1.2,0.64,1);
            position: relative;
            overflow: hidden;
            word-wrap: break-word;
            white-space: pre-wrap;
            backdrop-filter: blur(8px);
        }

        .opt-btn::after {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--accent-rose), var(--accent-lavender));
            border-radius: 3px 0 0 3px;
            opacity: 0;
            transform: scaleY(0);
            transition: all 0.25s;
        }

        .opt-btn:hover {
            border-color: var(--accent-blush);
            transform: translateX(6px);
            box-shadow: var(--shadow-soft);
            background: var(--option-hover);
        }

        .opt-btn:hover::after {
            opacity: 1;
            transform: scaleY(1);
        }

        .opt-btn:active { transform: translateX(4px) scale(0.99); }

        .opt-btn.back-btn {
            border-style: dashed;
            color: var(--text-secondary);
            background: transparent;
            display: flex; align-items: center; gap: 8px;
        }

        .opt-btn.back-btn:hover {
            color: var(--accent-rose);
            border-color: var(--accent-rose);
            transform: translateX(-4px);
        }

        .opt-btn.back-btn::after { display: none; }

        /* Empty state */
        .empty-options {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 14px;
            padding: 40px;
            text-align: center;
        }

        .empty-icon {
            font-size: 40px;
            opacity: 0.35;
        }

        .empty-text {
            font-size: 14px; /* tăng từ 13.5 */
            color: var(--text-secondary);
            line-height: 1.65;
            font-style: italic;
        }

        /* ──────────────── MODAL ──────────────── */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        .modal-overlay.show { display: flex; }

        .modal-box {
            background: var(--bg-card);
            border: 1px solid var(--border-accent);
            border-radius: 24px;
            padding: 40px;
            max-width: 580px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-lg);
            animation: modalIn 0.4s cubic-bezier(0.34,1.2,0.64,1);
            backdrop-filter: blur(20px);
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.92) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-box::-webkit-scrollbar { width: 5px; }
        .modal-box::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 10px; }

        .modal-close-btn {
            position: absolute; top: 18px; right: 18px;
            width: 34px; height: 34px;
            border-radius: 10px;
            background: var(--toggle-bg);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 15px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }

        .modal-close-btn:hover { background: rgba(200,114,104,0.1); color: var(--accent-rose); transform: rotate(90deg); }

        .modal-header-label {
            font-size: 12px; /* tăng từ 11 */
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent-rose);
            margin-bottom: 18px;
            font-weight: 500;
        }

        .modal-text {
            font-size: 15.5px; /* tăng từ 15 */
            color: var(--text-primary);
            line-height: 1.85;
            font-weight: 300;
        }

        /* ──────────────── TRANSITIONS ──────────────── */
        .fade-transition {
            transition: opacity 0.3s ease;
        }

        /* ──────────────── RESPONSIVE ──────────────── */
        /* Responsive cho mobile - cải thiện hiển thị options */
        @media (max-width: 768px) {
            /* Cấu trúc chat layout */
            .welcome-ornament{
                margin-top: 16px;
            }
            .chat-layout {
                flex-direction: column;
            }
            
            .panel-left {
                width: 100%;
                height: 50% !important;
                min-height: 250px;
            }
            
            .panel-right {
                width: 100%;
                height: 50% !important;
                min-height: 300px;
                display: flex;
                flex-direction: column;
            }
            
            /* Header của panel right */
            .panel-right-header {
                padding: 12px 16px;
                flex-shrink: 0;
            }
            
            /* Vùng chứa options - cải thiện khả năng cuộn */
            .options-scroll {
                flex: 1;
                overflow-y: auto;
                padding: 12px 12px;
                max-height: calc(50vh - 60px); /* Trừ chiều cao header */
                scrollbar-width: thin;
                scrollbar-color: var(--scrollbar) transparent;
            }
            
            /* Tùy chỉnh thanh cuộn cho đẹp hơn */
            .options-scroll::-webkit-scrollbar {
                width: 4px;
            }
            
            .options-scroll::-webkit-scrollbar-thumb {
                background: var(--scrollbar);
                border-radius: 4px;
            }
            
            /* Nút options - thu nhỏ để vừa nhiều lựa chọn hơn */
            .opt-btn {
                padding: 10px 14px;
                font-size: 13.5px;
                border-radius: 12px;
            }
            
            /* Giảm padding cho lần cuối để tiết kiệm không gian */
            .opt-btn:last-child {
                margin-bottom: 0;
            }
            
            /* Back button nhỏ gọn hơn */
            .opt-btn.back-btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            /* Empty state thu gọn */
            .empty-options {
                padding: 20px 12px;
            }
            
            .empty-icon {
                font-size: 32px;
            }
            
            .empty-text {
                font-size: 12.5px;
            }
        }

        /* Màn hình rất nhỏ (dưới 480px) */
        @media (max-width: 480px) {
            .panel-left {
                height: 45% !important;
            }
            
            .panel-right {
                height: 55% !important;
            }
            
            .options-scroll {
                max-height: calc(55vh - 60px);
                padding: 10px;
            }
            
            .opt-btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            /* Giảm số lượng options hiển thị cùng lúc bằng cách làm nút nhỏ hơn */
            .opt-btn {
                line-height: 1.4;
            }
        }

        /* Landscape mode - khi xoay ngang điện thoại */
        @media (max-width: 900px) and (orientation: landscape) {
            .chat-layout {
                flex-direction: row;
            }
            
            .panel-left {
                width: 55%;
                height: 100% !important;
            }
            
            .panel-right {
                width: 45%;
                height: 100% !important;
            }
            
            .options-scroll {
                max-height: calc(100vh - 120px);
            }
        }

        /* Đảm bảo logo luôn hiển thị */
        .logo-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px; /* Giới hạn độ rộng */
        }

        @media (max-width: 480px) {
            .logo-name {
                max-width: 100px;
            }
        }

        @media (max-width: 360px) {
            .logo-name {
                max-width: 80px;
            }
        }

        /* ===== PEER CHAT SETUP - MOBILE FIXES ===== */
        @media (max-width: 768px) {
            #peerChatSetup {
                padding: 20px 16px;
                justify-content: flex-start; /* không căn giữa, tránh mất nội dung */
            }

            .welcome-titleơ{
                font-size: 60%;
            }

            .peer-setup-card {
                padding: 28px 20px;
                max-width: 100%;
                max-height: 100%;
                overflow-y: auto; /* cho phép cuộn trong card nếu cần */
            }

            .peer-setup-icon {
                width: 60px;
                height: 60px;
                font-size: 26px;
                margin-bottom: 16px;
            }

            .peer-setup-title {
                font-size: 24px;
            }

            .peer-setup-subtitle {
                font-size: 13px;
                margin-bottom: 24px;
            }

            .peer-topic-grid {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
            }

            .peer-topic-btn {
                padding: 8px 10px;
                font-size: 12px;
            }

            .peer-form-input {
                padding: 10px 14px;
            }

            .peer-find-btn {
                padding: 12px;
                font-size: 14px;
            }

            .peer-privacy-note {
                font-size: 10px;
            }
        }

        /* ===== MOBILE FIXES CHO TÂM SỰ TỰ DO ===== */
        @media (max-width: 768px) {
            /* Đảm bảo panel-left chiếm toàn bộ chiều cao khi ở chế độ full-width */
            .panel-left.full-width {
                height: 100% !important;
            }

            /* Vùng chứa peer setup */
            #peerChatSetup {
                justify-content: flex-start !important;  /* Nội dung bám từ trên xuống */
                padding: 20px 16px;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;       /* Cuộn mượt trên iOS */
            }

            /* Card thiết lập */
            .peer-setup-card {
                padding: 28px 20px;
                max-width: 100%;
                margin: 0 auto;
                overflow: visible;                        /* Không giới hạn chiều cao bên trong */
            }

            /* Giảm kích thước icon */
            .peer-setup-icon {
                width: 60px;
                height: 60px;
                font-size: 26px;
                margin-bottom: 16px;
            }

            /* Tiêu đề */
            .peer-setup-title {
                font-size: 24px;
            }

            .peer-setup-subtitle {
                font-size: 13px;
                margin-bottom: 24px;
            }

            /* Form */
            .peer-form-input {
                padding: 10px 14px;
                font-size: 14px;
            }

            /* Grid chủ đề */
            .peer-topic-grid {
                gap: 6px;
            }

            .peer-topic-btn {
                padding: 8px 10px;
                font-size: 12px;
            }

            /* Nút tìm kiếm */
            .peer-find-btn {
                padding: 12px;
                font-size: 14px;
                margin-top: 4px;
            }

            /* Ghi chú ẩn danh */
            .peer-privacy-note {
                font-size: 10px;
                margin-top: 8px;
            }
        }

        /* Màn hình rất nhỏ (dưới 480px) */
        @media (max-width: 480px) {
            .peer-setup-card {
                padding: 20px 16px;
            }

            .peer-setup-icon {
                width: 52px;
                height: 52px;
                font-size: 22px;
            }

            .peer-setup-title {
                font-size: 20px;
            }

            .peer-topic-grid {
                grid-template-columns: 1fr;   /* Xếp dọc các nút chủ đề */
            }
        }

        /* Landscape mode (xoay ngang) */
        @media (max-width: 900px) and (orientation: landscape) {
            .panel-left.full-width {
                height: 100% !important;
            }

            #peerChatSetup {
                padding: 16px 20px;
            }

            .peer-setup-card {
                padding: 20px 24px;
            }

            .peer-topic-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 cột trên màn hình ngang */
            }
        }

        /* ══════════════════════════════════════════════════
           MOBILE COMPREHENSIVE FIX
           Fix: peer-topic nhảy ra khỏi form
           Fix: welcome-screen bị header che
        ══════════════════════════════════════════════════ */

        /* --- Welcome screen: đảm bảo không bị header che --- */
        @media (max-width: 768px) {
            .welcome-screen {
                align-items: flex-start;       /* bám từ trên, không căn giữa */
                padding: 20px 16px 24px;       /* padding nhỏ hơn cho mobile */
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .welcome-inner {
                width: 100%;
                max-width: 100%;
                padding-bottom: 20px;
            }

            .welcome-hero {
                margin-bottom: 28px;
            }

            .welcome-ornament {
                font-size: 52px;
                margin-top: 8px;
                margin-bottom: 12px;
            }

            .welcome-title {
                font-size: 30px;
            }

            .welcome-subtitle {
                font-size: 14px;
            }

            .welcome-divider {
                margin: 24px 0;
            }

            .topics-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .topic-card {
                padding: 18px 14px;
            }

            .topic-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
                margin-bottom: 10px;
            }

            .topic-name {
                font-size: 15px;
            }

            .topic-desc {
                font-size: 11.5px;
            }
        }

        /* --- Peer setup: fix topic grid tràn ra ngoài form --- */
        @media (max-width: 768px) {
            #peerChatSetup {
                align-items: stretch;          /* stretch để card full width */
                padding: 16px 12px;
                justify-content: flex-start;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .peer-setup-card {
                width: 100%;
                max-width: 100%;
                padding: 24px 16px 20px;
                border-radius: 20px;
                overflow: visible;             /* không clip nội dung */
                box-sizing: border-box;
            }

            /* Form group không bị overflow */
            .peer-setup-form {
                width: 100%;
                gap: 12px;
            }

            /* Topic grid luôn nằm trong card */
            .peer-topic-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 6px;
                width: 100%;
                box-sizing: border-box;
            }

            .peer-topic-btn {
                width: 100%;
                padding: 9px 8px;
                font-size: 12px;
                box-sizing: border-box;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .peer-form-input {
                width: 100%;
                box-sizing: border-box;
                font-size: 14px;
            }

            .peer-find-btn {
                width: 100%;
                padding: 12px;
                font-size: 14px;
                box-sizing: border-box;
            }
        }

        /* Màn hình rất nhỏ (≤ 480px) */
        @media (max-width: 480px) {
            .welcome-screen {
                padding: 16px 12px 20px;
            }

            .welcome-ornament {
                font-size: 44px;
            }

            .welcome-title {
                font-size: 26px;
            }

            .topics-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            /* Peer card: giảm thêm padding */
            .peer-setup-card {
                padding: 20px 14px 16px;
            }

            .peer-topic-grid {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }

            .peer-topic-btn {
                font-size: 11.5px;
                padding: 8px 6px;
            }
        }

        /* Màn hình rất nhỏ (≤ 375px - iPhone SE, cũ) */
        @media (max-width: 375px) {
            .welcome-ornament {
                font-size: 38px;
            }

            .welcome-title {
                font-size: 23px;
            }

            .topics-grid {
                grid-template-columns: 1fr;   /* 1 cột trên màn hình cực nhỏ */
                gap: 8px;
            }

            .peer-setup-card {
                padding: 16px 12px;
            }

            .peer-topic-btn {
                font-size: 11px;
                padding: 7px 6px;
            }

            #peerChatSetup {
                padding: 12px 10px;
            }
        }